(function(b){var a=YAHOO.JP.girlip;a.define={request:{appid:"dj0zaiZpPU5IM01yM29xVWQyMCZkPVlXazlUbEZDTlUxTk5UZ21jR285TUEtLSZzPWNvbnN1bWVyc2VjcmV0Jng9MDM-"},day:new Array("日","月","火","水","木","金","土"),url:{loginVerify:"https://login.yahoo.co.jp/config/login_verify2",done:location.protocol+"//"+location.hostname+location.pathname+"#"+location.hash.replace(/^#/,""),src:"trv"},img:{noImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/img_spare_300_200.png",spotNoImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/img_spotnoimage_01.png"},yolpSpot:{genre:["その他","食べる","買う","遊ぶ","暮らす"]},spotTrafficView:{type_select_fail:'<p id="trafficError" class="error">移動手段を選択してください</p>'},spotFreeView:{empty_input:'<p id="freeError" class="error">内容が未入力です。</p>'},localSearchParam:{sightseeing:{id:"98c3fee387a42040f9cd0cb8a2889214"+",cd246abc0da32d9d0e4990a54e3bf0e4"+",4f20d833838a6e5eb70e55811ae36a2f",abid:"495994ae74f963272cb2911309aa63d6"+",1db65834a724b77c9cda45b03ade74e8",gc:"0301"+",0302"+",0303"+",0305"+",0306"+",0307"+",0308"+",0424"+",02"+",0419005"},food:{id:"0239ef1233ea70500d7a320e06f439ea"+",20c4cc8c6339cc78326d4d5f0395dcb0"+",3f48a559dbfef9bd7ba6b6ef784e23b8"+",04dfaa08e72a293f512172ab2c22ed73"+",a6e27b84663abc4336dc275c6fb7f978"+",f6c0acee48bccac4cd11007f033f5249"+",1ce563045a57dcf322cf37697bc052ff"+",8170d3e4421ba0349f8437201db63c1a"+",0adbb2eb6a4a89999fda6944c6785d0d"+",47a5b8f36f9ffca1620e82c462a8cd4c"+",87e137ef107ce2c8c34094f96182a465",abid:"495994ae74f963272cb2911309aa63d6"+",1db65834a724b77c9cda45b03ade74e8",gc:"01"},inn:{id:"8024afaf82bcaaa4c33b91deea651df1"+",a02d41b2d8687d88080a782510dea10c"+",98c3fee387a42040f9cd0cb8a2889214",abid:"495994ae74f963272cb2911309aa63d6"+",88b7809e38a53132ed97682fd9b98e2a",gc:"0304"}},cidGenreEat:0,cidGenreSee:1,cidGenreInn:2,cidGenreName:["食べる","観光する","泊まる"],MAX_COMMENT_LENGTH:1000,genreMaster:{"spot":{"0":{className:"heart",classText:"ハート"},"1":{className:"gourmet",classText:"グルメ"},"2":{className:"stars",classText:"スター"}},"transfer":{"0":{className:"train",classText:"電車"},"1":{className:"plane",classText:"飛行機"},"2":{className:"car",classText:"くるま"},"3":{className:"toho",classText:"徒歩"},"4":{className:"bicycle",classText:"自転車"},"5":{className:"ferry",classText:"ふね"},"6":{className:"bus",classText:"バス"},"7":{className:"foot",classText:"その他"}}}};
}(jQuery));if(jQuery){jQuery.easing._ease=function(e,f,a,h,g){if(f==0){return a;}if(f==g){return a+h;}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a;}return h/2*(-Math.pow(2,-10*--f)+2)+a;};}var YAHOO=YAHOO||{};
YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.Common={isMobile:function(){var a=navigator.userAgent,b=a.match(/(iPhone|iPad|Android)/)?true:false;YAHOO.JP.travel.Common.isMobile=function(){return b;
};return b;},isPad:function(){var a=navigator.userAgent,b=a.match(/iPad/)?true:false;YAHOO.JP.travel.Common.isPad=function(){return b;};return b;},isIE:function(){var d=navigator.userAgent.toLowerCase(),f=(d.indexOf("msie")!=-1)||(d.indexOf("trident")!=-1),e=/msie (\d{1})/,a=d.match(e),c;
if(f&&a){a=a[1];}if(f){c=document.documentMode;}var b={isIe:f,ver:a,dmode:c};YAHOO.JP.travel.Common.isIE=function(){return b;};return b;},setCenter:function(d,a,c,i){var g=a.get(0),e=(i&&i.height)?i.height:(g&&g.innerHeight?g.innerHeight:a.height()),h=(i&&i.width)?i.width:(g&&g.innerWidth?g.innerWidth:a.width()),f=(e-d.height())/2+(c?a.scrollTop():0),b=(h-d.width())/2+(c?a.scrollLeft():0);
d.hide().css({top:f,left:b}).show();},setStringFormat:function(c){var b={result:true,text:""},g="";if(!c||!c.text||!c.num){b.result=false;return b;}if(typeof c.text!=="string"){c.text=c.text.toString();
}if(c.isMulti){if(((c.text.match(/[^\w]/g)||[]).length*2+(c.text.match(/[\w]/g)||[]).length)>c.num*2){var f=c.text.split("");for(var e=0,a=f.length,d=0;e<a;e++){d+=f[e].match(/[^\w]/)?2:1;if(d>c.num*2){break;
}g=g+f[e];}}}else{if(c.text.length>c.num){g=c.text.substr(0,c.num);}}if(g){g=c.isDot?g+c.isDot:g;b.text=g;b.result=false;}return b;},httpProxy:function(a,b){if(!a||!a.match(/^http:\/\/.+/)||!b){return a;
}if(a.match(/^http:\/\/travel.c.yimg.jp\/.+/)){return a.replace(/^http:\/\//,"https://");}return b+"/image/"+a.replace(/^http:\/\//,"");},numToYen:function(a){a=new String(a);while(a!=(a=a.replace(/^(-?\d+)(\d{3})/,"$1,$2"))){}return a;
},getElementSize:function(a){a=$(a);return{h:a.outerHeight(),w:a.outerWidth()};},escapeHtmlChars:function(a){if(a===""||a===null||!a){return a;}return a.replace(/<.+?>/g,"").replace(/'/g,"’").replace(/"/g,"”").replace(/&/g,"&amp;").replace(/\//g,"");
},returnHtmlChars:function(a){if(a===""||a===null||!a){return a;}return a.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/&amp;/g,"&");
},setTextareaCheck:function(a){if(!a||!a.target||!a.num){return;}a.callback=a.callback||function(){};a.isSlice=a.isSlice||false;a.target.on("blur",function(){var b=$(this),c=b.val().length;if(c>a.num){if(a.isSlice){b.val(b.val().slice(0,a.num));
}a.callback();}});},makeModal:function(c){if(!c||!c.target){return;}var d=$(c.target).clone(),f=c.text||"よろしいですか？",a=$("body");if(c.fix_sel){d.find(c.fix_sel).click(function(){d.remove();b.remove();c.fix();
});}if(c.cancel_sel){d.find(c.cancel_sel).click(function(){d.remove();b.remove();c.cancel();});}if(c.close_sel){d.find(c.close_sel).click(function(){d.remove();b.remove();c.close();});}d.find(c.text_sel).html(c.text);
if(c.fix_text){d.find(c.fix_sel).html(c.fix_text);}if(c.cancel_text){d.find(c.cancel_sel).html(c.cancel_text);}d.css({"position":"absolute","z-index":"20001","display":"none"}).appendTo(a);var e=$(document),b=$("<div></div>").css({"position":"absolute","top":"0px","left":"0px","width":e.width(),"height":e.height(),"z-index":"20000","opacity":"0.75","display":"none","text-align":"center","background-color":"#000"}).appendTo(a);
this.setCenter(d,$(window),true);b.show();d.fadeIn("fast");},getXhrAd:function(a){if(!a){return;}$.ajax({url:"/adlog/generate?sid="+a,type:"GET",dataType:"json",cache:false}).done(function(b){if(!b||!b.result||b.result!=="ok"||!b.tag){return;
}$("#logarea").html(b.tag);}).fail(function(){return false;});},insertATag:function(a){a=a.replace(/&#x2F\;/g,"/");var b=a.replace(/(https?):\/\/[^"@'\t\v\f\n\r\s]+/gm,this.replaceUrl);return b;},replaceUrl:function(a){return'<a class="urlLabel" target="_blank" href="'+a+'">'+a+"</a>";
},replaceAll:function replaceAll(b,c,a){return b.split(c).join(a);}};YAHOO=YAHOO||{};YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.girlip=YAHOO.JP.travel.girlip||{};YAHOO.JP.travel.girlip.view_print=function(){return(this instanceof YAHOO.JP.travel.girlip.view_print)?this.init(arguments[0]):new YAHOO.JP.travel.girlip.view_print(arguments[0]);
};YAHOO.JP.travel.girlip.view_print.prototype={LIB_COMMON:YAHOO.JP.travel,logmap:{2080267529:"2080267529"},init:function(){var X={"font-size":"87.5%","font-weight":"normal"},N={"margin":"0px"},y={"position":"relative","top":"auto","margin-top":"-30px","page-break-after":"always"},d={"width":"300px","background-position":"100px 0px"},z={"background-position":"35px 0"},r={"width":"800px","padding-left":"100px","text-align":"left","margin":"25px 0 50px"},U={"position":"absolute","top":"-12px","left":"0px"},s={"position":"relative","font-size":"1.38em","color":"#765946","padding-left":"50px"},J={"padding":"0 5px"},C={"color":"#444","margin-top":"15px","font-weight":"bold"},W={"position":"relative","padding-left":"220px","height":"120px","margin-top":"15px","color":"#444"},V={"position":"absolute","top":"0px","left":"0px","width":"190px","height":"120px","border":"1px solid #765946","border-radius":"5px","margin-left":"2px"},T={"font-size":"1.06em","font-weight":"bold","margin-bottom":"15px"},c={"font-size":"0.63em","margin-bottom":"20px"},S={"margin-top":"5px"},e={"font-size":"0.63em"},h={"margin-top":"20px"},x={"position":"relative","font-size":"0.63em","min-height":"70px"},K={"position":"absolute","top":"0px","left":"0px","border-radius":"100px","width":"54px","height":"54px"},D={"padding-left":"70px","color":"#444","line-height":"1.25em","margin-bottom":"20px"},Y={"color":"#765946"},m={"margin-top":"100px","page-break-before":"always"},I={"font":"bold 1.25em ''","margin":"20px 0px 20px 0px"},n={"padding":"20px 50px 100px","border":"10px solid #FFEDCA","border-radius":"15px"},G={"position":"relative","min-height":"70px"},H={"height":"50px","width":"100%"},g={"position":"absolute","top":"0px","right":"0px","background":"#755A46","border":"5px solid #FFFFFF","border-radius":"4px","box-shadow":"0 0 2px #000000","color":"#fff","font":"bold 1.13em ''","padding":"10px 20px","text-align":"center","width":"140px","cursor":"pointer"};
var O={"spot":{"0":{className:"heart",classText:"ハート"},"1":{className:"gourmet",classText:"グルメ"},"2":{className:"stars",classText:"スター"}},"transfer":{"0":{className:"train",classText:"電車"},"1":{className:"plane",classText:"飛行機"},"2":{className:"car",classText:"車"},"3":{className:"toho",classText:"歩いて"},"4":{className:"bicycle",classText:"自転車"},"5":{className:"ferry",classText:"フェリー"},"6":{className:"bus",classText:"バス"},"7":{className:"foot",classText:"その他"}}};
var u=YAHOO&&YAHOO.JP&&YAHOO.JP.girlip&&YAHOO.JP.girlip.data&&YAHOO.JP.girlip.data.planData&&YAHOO.JP.girlip.data.planData.planStartDate;if(!u){return;}var R=YAHOO.JP.girlip.data.schedule&&YAHOO.JP.girlip.data.schedule.info;
if(!R){return;}var E=YAHOO.JP.girlip.data.planComment||[];var L=YAHOO.JP.girlip.data.memberInfo,Q={};for(var P=L.length;P--;){Q[L[P].member_id]={img:L[P].image,name:L[P].nickname};}var k=$(".schedView"),F=$("#print_wrap");
if(!F.length){F=$("<div>").hide().addClass("schedView").attr("id","print_wrap").html('<div class="ue"><span class="bgOhayo"></span></div>'+'<div class="chuo group"></div>').insertBefore(k);}var p=F.find(".chuo");
o(A(u)).appendTo(p);var t=R[0].spot_day||R[0].transfer_day,v=t;for(var P=0,M=R.length;P<M;P++){v=R[P][R[P].spot_day?"spot_day":"transfer_day"];if(t!=v){q().appendTo(p);p=b(v);t=v;}a(R[P]).appendTo(p);}if(E.length){f().appendTo(F);
}j();function A(aa,ab){if(!aa.match(/^(\d{4})(\d{2})(\d{2})$/)){return;}var Z=new Date(RegExp.$1,RegExp.$2-1,RegExp.$3),w=Z.getTime(),i=ab?ab*86400000:0,w=w+i,l=["日","月","火","水","木","金","土"];Z.setTime(w);
return(Z.getMonth()+1)+"月"+Z.getDate()+"日（"+l[Z.getDay()]+"）";}function b(l){F.append($('<div class="ue"><span class="bgOhayo"></span></div>'));var i=$('<div class="chuo group"></div>').appendTo(F);o(A(u,l-1)).appendTo(i);
return i;}function o(i){return $('<h3 class="ohy"><span>'+i+"</span></h3>").css(X).find("span").css(N).end();}function q(){return $('<h3 class="oys"><span>おやすみ</span></h3>').css(X).css(y).find("span").css(N).end();
}function a(ah){var ap=ah.spot_day?true:false,an=$('<div class="print_unit"></div>'),ac=O[ap?"spot":"transfer"],ak=ac[ah[ap?"action_type":"transfer_type"]];var ab=$('<div class="print_itwrap">'+ah.start_time+'<span class="leader">・・・</span>'+ah.finish_time+"</div>").appendTo(an);
if(ak&&!(ap&&!ah.uid)){$('<span class="'+ak.className+' type03 print_icon"><span>'+ak.classText+"</span></span>").appendTo(ab);}if(ap&&ah.uid){var ao=$('<div class="print_spotWrap"><img class="print_spotImage" src="'+ah.spot_pics+'"></div>').appendTo(ab);
var ad=Math.ceil(ah.ratingDisplay/10)+"0";var ad=ah.ratingDisplay?'</div><span class="review st'+ad+'"><span></span>'+ah.rating+"</span>":"";var ae=ah.tel?'<div class="print_spotTel">電話番号 ： '+ah.tel+"</div>":"";
var am=ah.address?ah.address:"住所の情報はありません";$('<div class="print_unitTitle2">'+ah.spot_name+'</div><div class="print_spotCtnt">'+am+ae+ad).appendTo(ao);}else{if(ah.transfer_day){$('<div class="print_unitTitle">'+ah.transfer_means+"</div>").appendTo(ab);
}else{$('<div class="print_unitTitle">'+ah.spot_name+"</div>").appendTo(ab);}}if(ah.commentSet){var al,ai,aj;var ag=$("<div></div>").css(h).appendTo(ab);for(var af=0,aa=ah.commentSet.length,al,Z;af<aa;
af++){al=ah.commentSet[af];ai=Q[al.member_id].img;aj=Q[al.member_id].name;Z=$('<div class="print_comunit"></div>').appendTo(ag);$('<img src="'+ai+'">').appendTo(Z);$('<div class="print_intext"><span class="print_comname">'+aj+"</span><br>"+al.comment+"</div>").appendTo(Z);
}}return an;}function f(){var ab=$("<div></div>").css(m);$("<div></div>").css(H).appendTo(ab);$("<div>しおりへのコメント</div>").css(I).appendTo(ab);var ag,aa,af;var ae=$("<div></div>").css(n).appendTo(ab);for(var ad=0,Z=E.length,ag,ac;
ad<Z;ad++){ag=E[ad];if(Q[ag.member_id]===void 0){continue;}aa=Q[ag.member_id].img;af=Q[ag.member_id].name;ac=$('<div class="print_siorycomunit"></div>').appendTo(ae);$('<img src="'+aa+'">').appendTo(ac);
$('<div class="print_intext"><span class="print_comname">'+af+"</span><br>"+ag.comment+"</div>").appendTo(ac);}$("<div></div>").css(H).appendTo(ab);return ab;}function j(){$('<div class="print_sioryback">しおりに戻る</div>').css(g).appendTo(F.find(".chuo").eq(0)).click(function(){location.reload();
});}F.find(".bgOhayo").css(d);F.find(".chuo").css(z);F.find(".print_unit").css(r);F.find(".print_itwrap").css(s);F.find(".print_icon").css(U);F.find(".leader").css(J);F.find(".print_unitTitle").css(C);
F.find(".print_spotWrap").css(W);F.find(".print_spotImage").css(V);F.find(".print_unitTitle2").css(T);F.find(".print_spotCtnt").css(c);F.find(".print_spotTel").css(S);F.find(".review").css(e);F.find(".print_comunit").css(x);
F.find(".print_comunit img").css(K);F.find(".print_intext").css(D);F.find(".print_comname").css(Y);F.find(".print_siorycomunit").css(G);F.find(".print_siorycomunit img").css(K);k.hide();F.show();$(".header").find("p span, ul").hide();
$(".tabiGaiyo").css({"height":"315px","border-bottom":"10px solid #ccc"}).find(".mainNav").hide().end().find(".tabiJikan").css("bottom","25px");$("#tabiTomoMenu").hide();$('<h3 class="oys"><span>おかえり</span></h3>').find("span").css(N).end().appendTo(F.find(".chuo:last"));
$('<div class="shita bg01"></dvi>').appendTo(F);$("address").text("Copyright (C) 2013 Yahoo Japan Corporation. All Rights Reserved.");var B=$(".tabiGaiyo .gWrp02 h2").text();document.title=B;window.document.title=B;
window.print();this.LIB_COMMON.Common.getXhrAd(this.logmap["2080267529"]);}};var YAHOO=YAHOO||{};YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.CoverLayer=function(){return(this instanceof YAHOO.JP.travel.CoverLayer)?this.init(arguments[0]):new YAHOO.JP.travel.CoverLayer(arguments[0]);
};YAHOO.JP.travel.CoverLayer.active=false;YAHOO.JP.travel.CoverLayer.prototype={init:function(){this.args=this.checkArgs(arguments[0]);if(!this.args){return;}if(this.args.exclusive&&YAHOO.JP.travel.CoverLayer.active){return;
}YAHOO.JP.travel.CoverLayer.active=true;this.setCover();},checkArgs:function(){var a=arguments[0];if(!a){return false;}a.target=a.target?$(a.target):"";var b={"color":"#000","opacity":"0.75","zindex":"10000","fade":true,"duration":"fast","cback":"","fback":function(){},"exclusive":true};
return $.extend(b,a);},setCover:function(){var b=this.args,c=this,a=b.target?false:true;if(!a){b.target.css("position",b.is_abs?"absolute":"relative");}this.cl=$("<div></div>").css({"position":"absolute","top":"0px","left":"0px","width":(a?$(document):b.target).width(),"height":(a?$(document):b.target).height(),"z-index":b.zindex,"opacity":b.opacity,"display":"none","text-align":"center","background-color":b.color}).click(function(){var d=b.cback?b.cback():true;
if(d){c.removeCover();}});if(b.addCss){this.cl.css(b.addCss);}this.cl.appendTo((a?$("body"):b.target));if(b.fade){this.cl.fadeIn(b.duration,function(){c.setLoadingImage.apply(c);b.fback();});}else{this.cl.show();
c.setLoadingImage.apply(c);}},setLoadingImage:function(){if(!this.args.loadingImage){return;}var g=0,f=0,c=this.args;var d=$.extend({"position":"absolute","top":"-10000px"},c.loadingCss?c.loadingCss:{});
var a=$("<img />").attr("src",this.args.loadingImage).css(d).appendTo(this.cl).load(function(){var j=$(this),k=$(window),i=c.target?false:true;YAHOO.JP.travel.Common.setCenter(j,(i?k:c.target),(i?true:false));
});var h=YAHOO.JP.travel.Common.isIE();if(h.isIe){var e=$(window),b=c.target?false:true;YAHOO.JP.travel.Common.setCenter(a,(b?e:c.target),(b?true:false));}},removeCover:function(){this.cl.remove();YAHOO.JP.travel.CoverLayer.active=false;
},hideCover:function(b,a){a=a?a:(function(){});if(b){this.cl.fadeOut(this.args.duration,a);}else{this.cl.hide();a();}YAHOO.JP.travel.CoverLayer.active=false;},showCover:function(b,a){a=a?a:(function(){});
if(b){this.cl.fadeIn(this.args.duration,a);}else{this.cl.show();a();}YAHOO.JP.travel.CoverLayer.active=true;}};var YAHOO=YAHOO||{};YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.Mordal=function(){return(this instanceof YAHOO.JP.travel.Mordal)?this.init(arguments[0]):new YAHOO.JP.travel.Mordal(arguments[0]);
};YAHOO.JP.travel.Mordal.active=false;YAHOO.JP.travel.Mordal.prototype={init:function(){this.args=this.checkArgs(arguments[0]);if(!this.args){return;}if(this.args.exclusive&&YAHOO.JP.travel.Mordal.active){return;
}YAHOO.JP.travel.Mordal.active=true;this.makeMordal();},checkArgs:function(){var b=arguments[0],d=this;if(!b){return false;}var c=["target"];for(var a=c.length;a--;){if(!b[c[a]]){return false;}}if($.type(b.target)=="string"){b.target=$(b.target);
}var e={"color":"#000","opacity":"0.75","zindex":"10000","fade":true,"duration":"fast","cback":function(){return false;},"fselector":".mdl_cancel","sselector":".mdl_ok","fback":b.fback||function(){d.removeMordal();
},"sback":b.sback||function(){d.removeMordal();},"exclusive":true,"is_remove":false};return $.extend(e,b);},makeMordal:function(){var b=this.args,c=this;var d={"target":"","fback":a};this.cl=YAHOO.JP.travel.CoverLayer($.extend({},b,d));
function a(){c.setCenter(b.target);b.target.on("click",b.fselector,b.fback);b.target.on("click",b.sselector,b.sback);b.target.css("zIndex",b.zindex*1+1).show();}},setCenter:function(f){f.css({"position":"absolute","top":"-10000px","left":"-10000px","display":"block"});
var e=$(document),d=$(window),b=f.get(0),c=b&&b.innerHeight?b.innerHeight:f.height(),a=d.height()<c?d.scrollTop()+30:(d.height()-c)/2+d.scrollTop();f.hide().css({"top":a,"left":(e.width()-(b&&b.innerWidth?b.innerWidth:f.width()))/2+d.scrollLeft()});
return f;},removeMordal:function(a){this.cl.removeCover();this.args.target.hide();if(a||this.args.is_remove){this.args.target.remove();}YAHOO.JP.travel.Mordal.active=false;}};YAHOO=YAHOO||{};YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.girlip=YAHOO.JP.travel.girlip||{};YAHOO.JP.travel.girlip.siory_memo=function(){return(this instanceof YAHOO.JP.travel.girlip.siory_memo)?this.init(arguments[0]):new YAHOO.JP.travel.girlip.siory_memo(arguments[0]);
};YAHOO.JP.travel.girlip.siory_memo.prototype={LIB_COMMON:YAHOO.JP.travel,GIRLIP_DEFINE:YAHOO.JP.girlip.define,TITLE_LENGTH:15,inputCheckErrorFlg:false,updateCheckErrorFlg:false,logmap:{2080267528:"2080267528"},init:function(a){var b=a.data||[];
this.schedule=a.schedule;this.user_id=b.userId;this.plan_id=this.schedule.getPlanId();this.comment=b.planComment||[];this.eventTarget=a.trgt||"a.chuHoka";this.updateSioryMemo();this.addAllEvent();},addAllEvent:function(){this.menu=$("#chudanMenu");
this.menu.find(this.eventTarget).click($.proxy(this.showComment,this));},showComment:function(){var h=this.comment,m=this.user_id,d=this.schedule.getMemberData(),f=this.plan_id,b=h.length,g={};for(var e=d.length;
e--;){g[d[e].member_id]=d[e];}var a=this.getSequence(),c=$("#comment_modal").clone().attr("id",a);c.find("h2").text("みんなのメモ").css("font-size","1.5em").end().find("h5").text(b?b+"件のメモがあります":"メモはまだありません").end().find("textarea[my-entry]").val("").attr("placeholder","メモを書く （最大1000文字まで）");
c.find("textarea[my-edit]").attr("placeholder","メモを書く （最大1000文字まで）");this.my_data=g[m];this.modal_id=a;this.modal=c;this.modal.find(".frmWrp textarea").addClass("mm_ex").end().find(".frmWrp .btn10").addClass("mm_btn_ex");
$("<div></div>").addClass("mm_chbox").html('<label><input type="checkbox"><div>旅ともに<br>メールで<br>通知する</div></label>').appendTo(this.modal.find(".frmWrp"));var j=c.find(".comment_wrapper");for(var e=0,k,d;
e<b;e++){d=h[e].member_id;if(!g[d]){continue;}k=this.createCommentNode({comment:h[e],is_user:d==m,user:g[d]});k.appendTo(j);}this.addCommentBlockEvent(c);this.modal.find(".comment_wrapper").perfectScrollbar();
this.modal.find(".frmWrp textarea").placeholder();c.appendTo($("body"));var l=YAHOO.JP.travel.Mordal({target:c,fselector:".batsu",is_remove:true});this.LIB_COMMON.Common.getXhrAd(this.logmap["2080267528"]);
},createCommentNode:function(c){var d=this.LIB_COMMON.Common.insertATag(c.comment.comment);var a=$("<li></li>").attr("my-comid",c.comment.comment_id),b=[];b.push('<img src="'+c.user.image+'" alt="">');
b.push("<p><em>"+c.user.nickname+'</em><span class="cmd">'+this.convertCommentDate(c.comment.time));if(c.is_user){b.push('<a href="javascript:void(0);" class="btn09">修正・削除</a>');}b.push("</span></p>");
b.push('<p class="memo">'+d.replace(/[\n\r]/g,"<br />")+"</p>");return a.html(b.join(""));},convertCommentDate:function(b){if(!b){return"-";}var a;if(a=b.match(/^(\d{4})-(\d{2})-(\d{2}) (\d{2})\:(\d{2})\:(\d{2})$/)){return a[1]+"/"+a[2]+"/"+a[3]+" "+a[4]+":"+a[5];
}return"-";},addCommentBlockEvent:function(a){if(!a){return;}var b=this;a.on({click:function(){var f=$(this),c=f.parent().find("textarea[my-entry]"),i=c.val(),h=c.attr("placeholder");b.hideInputError();
if(!i||i==h){b.showInputError("メモ・コメントが入力されていません");return;}var e=b.plan_id,d=b.user_id,j=b.modal.find(".mm_chbox input").is(":checked")?"1":"0",g={comment:i,member_id:d,target_id:e,notice:j};b.entry=g;
$.proxy(b.showCover(),b);setTimeout(function(){if(b.inputCheckErrorFlg){b.inputCheckErrorFlg=false;b.showInputError("1000文字を超えています");b.cover.removeCover();}else{b.addCommentAPI({comment:g,success:$.proxy(b.addCommentSuccess,b),error:$.proxy(b.addCommentFailure,b)});
}},200);}},".btn10").on({click:function(){var e=$(this),h=e.closest("li").attr("my-comid"),g;if(!h){return;}b.modal.find(".edit_error").text("");for(var f=b.comment,c=f.length;c--;){if(f[c].comment_id==h){g=f[c];
break;}}if(!g){return;}b.showEditLayer(g);}},".btn09").on({click:function(){b.modal.find(".comment_modal_edit, .comment_modal_delete").hide().end().find("h2").text("みんなのメモ").removeClass("comment_back_active back").width("360px").end().find(".comment, .frmWrp").show();
}},".back, .comment_ret_btn").on({click:$.proxy(this.updateComment,this)},"#comment_edit_btn > a:first-child").on({click:$.proxy(this.deleteConfirm,this)},"#comment_edit_btn > a:last-child").on({click:$.proxy(this.cancelDelete,this)},"#comment_delete_btn > a:first-child").on({click:$.proxy(this.deleteComment,this)},"#comment_delete_btn > a:last-child");
this.LIB_COMMON.Common.setTextareaCheck({target:this.modal.find(".frmWrp textarea"),num:1000,callback:$.proxy(function(){this.inputCheckErrorFlg=true;this.showInputError("1000文字を超えています");},this),isSlice:true});
this.LIB_COMMON.Common.setTextareaCheck({target:this.modal.find(".comment_modal_edit textarea"),num:1000,callback:$.proxy(function(){this.updateCheckErrorFlg=true;this.showEditError("1000文字を超えています");},this),isSlice:true});
},addCommentAPI:function(a){a.comment.comment=_.escape(a.comment.comment);$.ajax({url:"/api/comment/"+this.plan_id+"?crumb="+this.schedule.getCrumb(),type:"POST",data:JSON.stringify(a.comment),contentType:"application/json",dataType:"json"}).done(function(b){if(b.httpcode!="200"){a.error();
return;}a.success(b.comment_id);}).fail(function(b){a.error(b);});},addCommentSuccess:function(a){if(!a){return;}this.modal.find("textarea[my-entry]").val("");var b=new Date(),i=b.getFullYear(),h=("0"+(b.getMonth()+1)).slice(-2),j=("0"+b.getDate()).slice(-2),c=("0"+b.getHours()).slice(-2),d=("0"+b.getMinutes()).slice(-2),f=("0"+b.getSeconds()).slice(-2);
var k=this.entry,e={comment:k.comment,comment_id:a,member_id:k.member_id,target_id:k.target_id,time:i+"-"+h+"-"+j+" "+c+":"+d+":"+f};this.comment.unshift(e);var g=this.createCommentNode({comment:e,is_user:true,user:this.my_data});
this.modal.find(".comment_wrapper").prepend(g);this.modal.find("h5").text(this.comment.length+"件のメモがあります");this.cover.removeCover();},addCommentFailure:function(b){var a="メモを追加する事が出来ませんでした";if(b&&b.status=="401"){a="不適切な文字が含まれています";
}this.showInputError(a);this.cover.removeCover();},showEditLayer:function(c){var b=this.modal;var a=this.modal.css({height:b.height(),width:b.width()}).find(".comment, .frmWrp").hide().end().find("h2").html('<span class="comment_back_arrow">◀</span><span class="comment_back">もどる<span>').addClass("comment_back_active back").width("160px").end().find(".comment_modal_edit");
a.find("img").attr("src",this.my_data["image"]).end().find("p").html("<em>"+this.my_data["nickname"]+'</em><span class="cmd">'+this.convertCommentDate(c.time)+"</span>").end().find("textarea").val(_.unescape(c.comment)).placeholder().end().show();
this.editData=c;this.LIB_COMMON.Common.getXhrAd(this.logmap["2080267528"]);},updateComment:function(){this.hideEditError();var e=this,f=this.editData,a=this.modal.find("textarea[my-edit]"),d=a.val(),c=a.attr("placeholder");
if(!d||d==c){this.showEditError("メモを入力して下さい");return;}this.showCover();var b={comment:d,comment_id:f.comment_id,member_id:f.member_id};setTimeout(function(){if(e.updateCheckErrorFlg){e.updateCheckErrorFlg=false;
e.showEditError("1000文字を超えています");e.cover.removeCover();}else{e.updateCommentAPI({comment:b,success:$.proxy(e.updateCommentSuccess,e),error:$.proxy(e.updateCommentFailure,e)});}},200);},updateCommentAPI:function(a){a.comment.comment=_.escape(a.comment.comment);
$.ajax({url:"/api/comment/"+this.plan_id+"?crumb="+this.schedule.getCrumb(),type:"PUT",data:JSON.stringify(a.comment),contentType:"application/json",dataType:"json"}).done(function(b){if(b.httpcode!="200"){a.error();
return;}a.success(a);}).fail(function(b){a.error(b);});},updateCommentSuccess:function(a){var d=this.spot_id,c=a.comment;a.target_id=d;for(var b=this.comment.length;b--;){if(this.comment[b].comment_id==c.comment_id){this.comment[b].comment=c.comment;
break;}}c.comment=this.LIB_COMMON.Common.insertATag(c.comment);this.modal.find('.comment_wrapper > li[my-comid="'+c.comment_id+'"]').find(".memo").html(c.comment.replace(/[\n\r]/g,"<br />"));this.cover.removeCover();
this.modal.find(".comment_modal_edit, .comment_modal_delete").hide().end().find("h2").text("みんなのメモ").removeClass("comment_back_active back").width("360px").end().find(".comment, .frmWrp").show();this.LIB_COMMON.Common.getXhrAd(this.logmap["2080267528"]);
},updateCommentFailure:function(b){var a="メモを編集する事が出来ませんでした";if(b&&b.status=="401"){a="不適切な文字が含まれています";}this.showEditError(a);this.cover.removeCover();},deleteConfirm:function(){var a=this.editData;this.modal.find(".comment_modal_edit").hide().end().find(".comment_modal_delete").show();
},cancelDelete:function(){this.modal.find(".comment_modal_edit").show().end().find(".comment_modal_delete").hide();},deleteComment:function(){this.showCover();this.deleteCommentAPI({success:$.proxy(this.deleteCommentSuccess,this),error:$.proxy(this.deleteCommentFailure,this)});
},deleteCommentAPI:function(a){var b=this.editData.comment_id;$.ajax({url:"/api/comment/"+this.plan_id+"?comment_id="+b+"&crumb="+this.schedule.getCrumb(),type:"DELETE",contentType:"application/json",dataType:"json"}).done(function(c){if(c.httpcode!="200"){a.error();
return;}a.success();}).fail(function(){a.error();});},deleteCommentSuccess:function(){var c={target_id:this.spot_id,comment_id:this.editData.comment_id};for(var b=this.comment.length;b--;){if(this.comment[b].comment_id==c.comment_id){this.comment.splice(b,1);
break;}}this.modal.find('.comment_wrapper > li[my-comid="'+c.comment_id+'"]').remove();var a=this.comment.length;this.modal.find("h5").text(a?a+"件のメモがあります":"メモはまだありません");this.cover.removeCover();this.modal.find(".comment, .frmWrp").show().end().find("h2").text("みんなのメモ").removeClass("comment_back_active back").width("360px").end().find(".comment_modal_delete").hide();
this.LIB_COMMON.Common.getXhrAd(this.logmap["2080267528"]);},deleteCommentFailure:function(){this.showEditError("メモを削除する事が出来ませんでした");this.cover.removeCover();this.modal.find(".comment_modal_edit").show().end().find(".comment_modal_delete").hide();
},updateSioryMemo:function(){var e=this.schedule.getMemberData(),a={};for(var c=e.length;c--;){a[e[c].member_id]=true;}var d=this.comment,b=[];for(var c=d.length;c--;){if(a[d[c].member_id]){b.push(d[c]);
}}this.comment=b;},getSequence:function(){return"seq"+(new Date()).getTime();},showInputError:function(a){this.modal.find("#comment_modal_error_1").text(a).show();},hideInputError:function(){this.modal.find("#comment_modal_error_1").hide();
},showEditError:function(a){this.modal.find(".edit_error").text(a).show();},hideEditError:function(){this.modal.find(".edit_error").hide();},showCover:function(){this.cover=this.LIB_COMMON.CoverLayer({target:"#"+this.modal_id,color:"#fff",cback:function(){return false;
},loadingImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif",loadingCss:{width:"20px",height:"20px"},addCss:{padding:"20px"},exclusive:false,is_abs:true});},openMemo:function(){$("#chudanMenu").find("a.chuHoka").click();
}};(function(b){var a=YAHOO.JP.girlip;a.viewCollection=Backbone.Collection.extend({viewBaseModel:undefined,dateTabModels:new Array(),scheduleItemModels:new Array(),editButtonModel:undefined,nextDayLinkModel:undefined,initialize:function(){this.initViewBaseModel();
this.initDateTabModel();this.initScheduleItemModel();this.initEditButtonModel();this.initNextDayLinkModel();},initViewBaseModel:function(){var c=new a.viewBaseModel({member_id:a.data.member_id,memberInfo:a.data.memberInfo});
this.add(c,{silent:true});this.viewBaseModel=c;},initDateTabModel:function(){var f=a.data;for(var e=0,c=f.planData.planDays;e<c;e++){var d=new a.dateTabModel({tabTitle:f.dayArray[e].date+" "+f.dayArray[e].dayOfTheWeek});
this.add(d,{silent:true});this.dateTabModels.push(d);}},initScheduleItemModel:function(){var f=a.data.schedule.info,c="",g="";for(var h=0,e=f.length;h<e;h++){c=f[h];var d;if(c.transfer_id){d=1;}else{if(c.uid){d=0;
}else{d=2;}}if(c.spot_pics){var j=c.spot_pics.split("http://");if(j[1]){c.spot_pics=a.data.httpProxy+j[1];}}g=new a.scheduleItemModel({spot_name:c.spot_name,transfer_means:c.transfer_means,spot_pics:c.spot_pics,start_time:c.start_time,finish_time:c.finish_time,spot_day:c.spot_day,spot_id:c.spot_id,transfer_id:c.transfer_id,transfer_day:c.transfer_day,transfer_type:c.transfer_type,action_type:c.action_type,commentSet:(c.commentSet)?c.commentSet:[],plan_id:c.plan_id,item_type:d,review:(c.review)?c.review:0,reviewUrl:(c.reviewUrl)?c.reviewUrl:"",rating:(c.rating)?c.rating:"0.00",address:(c.address!=undefined)?c.address:"住所の情報がありませんでした。",tel:(c.tel)?c.tel:""});
this.add(g);this.scheduleItemModels.push(g);}},initEditButtonModel:function(){var c=new a.editButtonModel({plan_id:a.data.planData.planId,redirect_url:a.data.currentUrl});this.add(c,{silent:true});this.editButtonModel=c;
},initNextDayLinkModel:function(){var c=new a.nextDayLinkModel({dayLength:a.data.dayArray.length});this.add(c,{silent:true});this.nextDayLinkModel=c;}});a.viewBaseModel=Backbone.Model.extend({defaults:{currentScheduleDay:1,masonryLayoutDone:false,member_id:undefined,memberInfo:undefined},setCurrentScheduleDay:function(c){this.set("currentScheduleDay",c);
},setMasonryLayoutDone:function(){this.set("masonryLayoutDone",true);this.set("masonryLayoutDone",false,{silent:true});}});a.dateTabModel=Backbone.Model.extend({defaults:{tabTitle:undefined}});a.scheduleItemModel=Backbone.Model.extend({initialize:function(){}});
a.commentModel=Backbone.Model.extend({urlRoot:"/api/comment/",defaults:{commentSet:undefined,current_member_id:undefined,target_id:undefined,plan_id:undefined},initialize:function(){},addComment:function(j,d,i,n,e){var h=e.substr(0,4)-0,g=e.substr(5,2)-0,l=e.substr(8,2)-0,f=e.substr(11,2)-0,m=e.substr(14,2)-0;
var c=h+"年"+g+"月"+l+"日 "+f+"時"+m+"分";var k=new Object({comment:j,comment_id:d,member_id:i,target_id:n,time:c});this.get("commentSet").unshift(k);this.trigger("post",k);},modComment:function(e,c){var d=this.get("commentSet");
d[c].comment=e;this.set("commentSet",d);},delComment:function(c){var d=this.get("commentSet");d.splice(c,1);this.set("commentSet",d);}});a.editButtonModel=Backbone.Model.extend({urlRoot:"/api/plan/",defaults:{plan_status:1,plan_id:undefined,redirect_url:undefined}});
a.nextDayLinkModel=Backbone.Model.extend({defaults:{dayLength:undefined}});}($));(function(b){var a=YAHOO.JP.girlip;a.dateTabView=Backbone.View.extend({tagName:"li",events:{"click":"tabClick"},initialize:function(){var c=this.collection.dateTabModels[this.attributes.tabIndex];var d=this.collection.viewBaseModel;
this.render();this.listenTo(d,"change:currentScheduleDay",this.setHighlight);this.listenTo(d,"change:currentScheduleDay",this.reloadScheduleItem);this.listenTo(d,"change:currentScheduleDay",this.hideModPlanErrorMsg);
},render:function(){var c=this.collection.dateTabModels[this.attributes.tabIndex];var d=this.collection.viewBaseModel;this.$el.html(c.get("tabTitle"));$(".mainNav").append(this.el);if(d.get("currentScheduleDay")==this.attributes.tabIndex+1){this.$el.addClass("sel");
}return this;},setHighlight:function(){if(this.collection.viewBaseModel.get("currentScheduleDay")==this.attributes.tabIndex+1){this.$el.addClass("sel");}else{this.$el.removeClass("sel");}},reloadScheduleItem:function(){var e=this.collection.viewBaseModel.get("currentScheduleDay");
if(this.collection.viewBaseModel.get("currentScheduleDay")==this.attributes.tabIndex+1){var c=_.filter(this.collection.scheduleItemModels,function(g){return g.get("spot_day")==e||g.get("transfer_day")==e;
});$(".vgridWrapper").html("");if(c.length==0){a.vg.vgrefresh("easeOutQuint",400,20,function(){$(".noPlan").fadeIn();});return;}else{$(".noPlan").hide();}var f="",d=0;_.each(c,function(h,g){f=new a.scheduleItemView({model:h,attributes:{itemIndex:g}});
d++;},this);a.vg.vgrefresh();if(d==1){f.setAlign();}}},hideModPlanErrorMsg:function(){if($(".modPlanError").is(":visible")){$(".modPlanError").hide();}},tabClick:function(){if(a.dateTabClicked==true){return;
}else{a.dateTabClicked=true;setTimeout(function(){a.dateTabClicked=false;},500);}YAHOO.JP.travel.Common.getXhrAd(a.data.ad.space_id);this.collection.viewBaseModel.setCurrentScheduleDay(this.attributes.tabIndex+1);
if(this.collection.nextDayLinkModel.get("dayLength")==this.attributes.tabIndex+1){$("h3.oys span").html("おかえり");}else{$("h3.oys span").html("おやすみ");}}});}(jQuery));(function(c){var b=YAHOO.JP.girlip,a=YAHOO.JP.travel.Common;b.scheduleItemView=Backbone.View.extend({tagName:"div",className:"appo",commentView:undefined,events:{"click .addComment":"openCommentInput"},initialize:function(){this.render();
this.listenTo(b.viewCollection.viewBaseModel,"change:masonryLayoutDone",this.setAlign);},render:function(){var d=this.model.get("item_type");if(d==0){this.renderSpotItem();}else{if(d==2){this.renderFreeItem();
}else{this.renderTransferItem();}}return this;},renderSpotItem:function(){var f=new Image();f.src=this.model.get("spot_pics");var k=f.width,j=f.height,h="",d="",i="";if(!k&&!j){d="height:282px; ";}if(j>400){d="height:400px; ";
}if(b.isIe7==true){h="width:423px; min-width:423px; max-width:423px; ";}else{h="width:423px; ";}i="min-height:282px; ";var g='<h4></h4><div class="inner spot">'+'<div class="imgWrp"><img src="'+this.model.get("spot_pics")+'" style="'+h+d+i+'" alt="'+this.model.get("spot_name")+'">';
if(this.model.get("reviewUrl")){g+='<h5><a href="'+this.model.get("reviewUrl").split("review")[0]+'" target="_blank">'+this.model.get("spot_name")+"</a></h5>";}else{g+="<h5><a>"+this.model.get("spot_name")+"</a></h5>";
}g+='</div><span class="dotted"></span><div class="info"><dl>'+'<dd class="if01"><span class="review '+this.getStarClass(this.model.get("rating"))+'"><span></span>'+this.model.get("rating")+"</span> - ";
if(this.model.get("reviewUrl")&&this.model.get("review")){g+='<a href="'+this.model.get("reviewUrl")+'" target="_blank">'+(this.model.get("review")||0)+"件</a>のクチコミ</dd>";}else{g+="0件のクチコミ</dd>";}if(this.model.get("address")==""||this.model.get("address")=="NULL"){g+="<dd>住所 : 情報を取得できませんでした。</dd>";
}else{var e=b.data.spotmapUrl+"?spot_id="+this.model.get("spot_id")+"&index="+this.attributes.itemIndex+"&day="+this.model.get("spot_day")+"&target=surround";g+="<dd>住所 : "+this.model.get("address")+'（<a href="'+e+'" target="_blank">周辺情報</a>）</dd>';
}g+="</dl></div></div>"+'<p class="addComment bubble02">メモ・コメントを追加する</p>';this.setMarginTop();this.$el.append(g);this.renderComment();$(".vgridWrapper").append(this.el);},renderFreeItem:function(){var e=a.insertATag(this.model.get("spot_name"));
var d="<h4></h4>";d+='<div class="inner min"><p class="free text">'+e+"</p></div>";d+='<p class="addComment bubble02">メモ・コメントを追加する</p>';this.setMarginTop();this.$el.append(d);this.renderComment();$(".vgridWrapper").append(this.el);
},renderTransferItem:function(){var e=a.insertATag(this.model.get("transfer_means"));var d="<h4></h4>";d+='<div class="inner min"><p class="transfer text">'+e+"</p></div>";d+='<p class="addComment bubble02">メモ・コメントを追加する</p>';
this.setMarginTop();this.$el.append(d);this.renderComment();$(".vgridWrapper").append(this.el);},renderComment:function(){var d=new b.commentModel({commentSet:this.model.get("commentSet"),plan_id:this.model.get("plan_id"),current_member_id:b.data.member_id,target_id:(this.model.get("spot_id"))?this.model.get("spot_id"):this.model.get("transfer_id")});
var e=new b.commentView({model:d});this.commentView=e;this.$el.find(".inner").append(e.el);},setAlign:function(){var f;var d=this.$el.find("h4");if($(this.el).css("left")=="0px"||$(this.el).css("left")=="auto"){d.addClass("right");
d.removeClass("left");f="type";}else{d.addClass("left");d.removeClass("right");f="type03";}var e=this.getIconType();var g=this.model.get("start_time")+'<span class="leader">・・・</span>'+this.model.get("finish_time");
if(e!==false){g+='<span class="'+e.className+" "+f+'"><span>'+e.classText+"</span></span>";}else{if(d.hasClass("right")){d.css("padding-right","5px");}else{d.css("padding-left","5px");}}d.css("display","none").html(g).show();
},openCommentInput:function(){if(this.$el.find(".postComment").is(":visible")){this.$el.find(".postComment .postError").hide();this.$el.find(".postComment").fadeOut("fast",_.bind(function(){b.vg.vgrefresh();
this.$el.find(".addComment").html("メモ・コメントを追加する");},this));}else{this.$el.find(".postComment").show();this.$el.find(".addComment").html("メモ・コメントをとじる");b.vg.vgrefresh();}},postComment:function(){var d=_.escape(this.$el.find("form textarea").val());
if(d==""){return;}this.commentView.postComment(d);},getStarClass:function(d){if(d<0.5){return"";}else{if(d<1.5){return"st10";}else{if(d<2.5){return"st20";}else{if(d<3.5){return"st30";}else{if(d<4.5){return"st40";
}else{if(d<=5.5){return"st50";}}}}}}return"";},getIconType:function(){var d={"spot":{"0":{className:"heart",classText:"ハート",meaning:"観光する"},"1":{className:"gourmet",classText:"グルメ",meaning:"食べる"},"2":{className:"stars",classText:"スター",meaning:"泊まる"}},"transfer":{"0":{className:"train",classText:"電車",meaning:"移動"},"1":{className:"plane",classText:"飛行機",meaning:"移動"},"2":{className:"car",classText:"車",meaning:"移動"},"3":{className:"toho",classText:"歩いて",meaning:"移動"},"4":{className:"bicycle",classText:"自転車",meaning:"移動"},"5":{className:"ferry",classText:"フェリー",meaning:"移動"},"6":{className:"bus",classText:"バス",meaning:"移動"},"7":{className:"foot",classText:"その他",meaning:"移動"}}};
if(this.model.get("item_type")==0){return d.spot[this.model.get("action_type")];}else{if(this.model.get("item_type")==1){return d.transfer[this.model.get("transfer_type")];}else{return false;}}},setMarginTop:function(){if($.find("div.appo").length==0){this.$el.css("margin-top","20px");
}else{if($.find("div.appo").length==1){this.$el.css("margin-top","60px");}}}});}(jQuery));(function(c){var b=YAHOO.JP.girlip,a=YAHOO.JP.travel.Common;b.commentView=Backbone.View.extend({tagName:"div",className:"comment",events:{"click .sarani":"showMore","click .btn11":"compactComment","click form .btn10 span":"postComment","click .mod":"openModUI","click .modPost":"modComment","click .del":"delComment"},initialize:function(){this.render();
this.listenTo(this.model,"post",this.renderNewComment);},render:function(){this.$el.find("ul").html("");var d="",f=this.model.get("commentSet");if(f&&f.length!=0){var h=f[0];var e=a.insertATag(h.comment);
var g=this.getPosterInfo(h);d+="<h5>最新のメモ・コメント</h5>"+'<a class="btn11"><span>メモ・コメントをとじる</span></a><ul>'+'<li><img alt="" src="'+g.image+'">'+"<p><em>"+g.nickname+"</em><span>"+e.replace(/[\n\r]/g,"<br />")+"</span></p>"+'<p class="editError" style="display:none;"></p>'+'<p class="cmd">'+h.time+'<a class="btn09 mod">修正</a><a class="btn09 del">削除</a></p></li></ul>';
}else{d+='<ul style="display:none"></ul>';}if(f&&f.length>1){d+='<a class="sarani">さらに'+(f.length-1)+"件のメモ・コメントを表示する</a>";}else{d+='<a class="sarani" style="display:none;"></a>';}d+='<div class="postComment" style="display:none;">'+'<p class="postError" style="display:none;">メモ・コメントの投稿に失敗しました。</p>'+'<form class="frm05 dotRnd" action="" >'+'<textarea placeholder="コメント（メモ）を書く （最大1000文字まで）"></textarea><a class="btn10">'+"<span>投稿する</span></a>"+'<img class="loading" src="https://s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif">'+"</form></div>";
this.$el.html(d);if(f&&f.length!=0&&!this.isCommentOwner(f[0])){this.$el.find(".btn09").hide();}this.$el.find(".btn11").hide();this.$el.find(".postComment textarea").autosize({callback:function(){b.vg.vgrefresh();
}});this.$el.find(".postComment textarea").val("").placeholder();return this;},showMore:function(){var d="",e=this.model.get("commentSet");_.each(e,function(h,f){if(f<1){return;}var g=a.insertATag(h.comment);
var i=this.getPosterInfo(h);d+='<li><img alt="" src="'+i.image+'">'+"<p><em>"+i.nickname+"</em><span>"+g.replace(/[\n\r]/g,"<br />")+"</span></p>"+'<p class="editError" style="display:none;"></p>'+'<p class="cmd">'+h.time;
if(this.isCommentOwner(h)){d+='<a class="btn09 mod">修正</a><a class="btn09 del">削除</a>';}d+="</p></li>";},this);this.$el.find("ul").append(d);this.$el.find("h5").html(e.length+"件のメモ・コメント");this.$el.find(".sarani").hide();
if(this.$el.find(".btn11").length){this.$el.find(".btn11").show();}else{this.$el.find("h5").after('<a class="btn11"><span>メモ・コメントをとじる</span></a>');}b.vg.vgrefresh();},compactComment:function(){this.$el.find("ul").html("");
var d="",g=this.model.get("commentSet")[0];var e=a.insertATag(g.comment);var f=this.getPosterInfo(g);d+='<li><img alt="" src="'+f.image+'">'+"<p><em>"+f.nickname+"</em><span>"+e.replace(/[\n\r]/g,"<br />")+"</span></p>"+'<p class="editError" style="display:none;"></p>'+'<p class="cmd">'+g.time+'<a class="btn09 mod">修正</a><a class="btn09 del">削除</a></p></li>';
this.$el.find("ul").prepend(d);if(!this.isCommentOwner(g)){this.$el.find(".btn09").hide();}this.$el.find("h5").html("最新のメモ・コメント");this.$el.find(".sarani").show();this.$el.find(".btn11").hide();b.vg.vgrefresh();
},postComment:function(d){this.logCountUp();this.$el.find(".postComment .postError").fadeOut();var f=this.$el.find("form textarea").val();if(f==""){this.$el.find(".postComment .postError").html("メモ・コメントが入力されていません");
this.$el.find(".postComment .postError").fadeIn();b.vg.vgrefresh();return;}if(f.length>b.define.MAX_COMMENT_LENGTH){this.$el.find(".postComment .postError").html("1000文字を超えています");this.$el.find(".postComment .postError").fadeIn();
b.vg.vgrefresh();return;}f=_.escape(f);$(d.target).parent().hide();this.$el.find("img.loading").show();$.ajax({type:"POST",url:this.model.url()+this.model.get("plan_id"),dataType:"json",data:JSON.stringify({"target_id":this.model.get("target_id"),"member_id":this.model.get("current_member_id"),"comment":f})}).done(_.bind(function(g,e){this.model.addComment(f,g.comment_id,this.model.get("current_member_id"),this.model.get("target_id"),g.insert_date);
this.$el.find(".postComment").fadeOut("fast",_.bind(function(){b.vg.vgrefresh();this.$el.find("img.loading").hide();this.$el.find(".btn10").show();this.$el.find("textarea").val("").trigger("autosize.resize");
$(".appo .addComment").html("メモ・コメントを追加する");},this));},this)).fail(_.bind(function(e,h,g){this.$el.find("img.loading").hide();this.$el.find(".btn10").fadeIn("fast");this.$el.find(".postComment .postError").html("メモ・コメントの投稿に失敗しました。");
this.$el.find(".postComment .postError").fadeIn();b.vg.vgrefresh();},this));},renderNewComment:function(f){var h=this.model.get("commentSet");this.$el.find(".sarani").html("さらに"+(h.length-1)+"件のコメントを表示する");
var i=this.getPosterInfo(f);var g=a.insertATag(f.comment);var e='<li><img alt="" src="'+i.image+'">'+"<p><em>"+i.nickname+"</em><span>"+g.replace(/[\n\r]/g,"<br />")+"</span></p>"+'<p class="editError" style="display:none;"></p>'+'<p class="cmd">'+f.time+'<a class="btn09 mod">修正</a><a class="btn09 del">削除</a></p></li>',d=h.length;
if(d>=3&&this.isMoreShowShow()){this.$el.find("ul").html("");this.$el.find("ul").html(e);}else{if(d>=3&&!this.isMoreShowShow()){this.$el.find("h5").html(h.length+"件のメモ・コメント");this.$el.find("ul").prepend(e);
}else{if(d==2){this.$el.find("ul").html("");this.$el.find("ul").html(e);this.$el.find(".sarani").show();}else{if(d==1){this.$el.prepend("<h5>最新のメモ・コメント</h5>");this.$el.find("ul").html(e).fadeIn("fast");
}}}}if(!this.isCommentOwner(f)){this.$el.find(".btn09").hide();}},removeCommentAt:function(d){var e=this.model.get("commentSet");this.$el.find(".sarani").html("さらに"+(e.length-1)+"件のコメントを表示する");if(!e.length){this.$el.find("ul li:eq("+d+")").remove();
this.$el.find("h5").remove();this.$el.find("ul").hide();}else{if(e.length==1){this.$el.find("ul li:eq("+d+")").remove();this.$el.find("h5").html("最新のメモ・コメント");this.$el.find(".btn11").hide();}else{this.$el.find("ul li:eq("+d+")").remove();
this.$el.find("h5").html(e.length+"件のメモ・コメント");}}b.vg.vgrefresh();},openModUI:function(d){var g=$(d.target).parent().parent();g.find("span").hide();g.find("p em").hide();g.find("p:first").after('<textarea class="modText" placeholder="コメント（メモ）を書く （最大1000文字まで）">'+g.find("span").html().replace(/<br>/gi,"\n")+"</textarea>");
g.find("textarea").placeholder();var f=_.unescape(g.find("span").text());g.find("textarea").val(f.replace(/<br>/gi,"\n"));g.find("textarea").select();g.find(".cmd .del").hide();g.find(".cmd .mod").removeClass("mod").addClass("modPost").html("決定");
$(d.target).parent().parent().find(".editError").html("").fadeOut();b.vg.vgrefresh();g.find("textarea").autosize({callback:function(){b.vg.vgrefresh();}});},closeModUI:function(f,d){var e=this.$el.find("li:eq("+d+")");
e.find("textarea").remove();e.find("em").show();f=a.insertATag(f);e.find("p span").html(f.replace(/[\n\r]/g,"<br />")).show();e.find(".cmd .del").show();e.find(".loading").removeClass("loading").addClass("mod").addClass("btn09").html("修正");
b.vg.vgrefresh();},modComment:function(f){this.logCountUp();$(f.target).parent().parent().find(".editError").html("").fadeOut();var i=$(f.target).parent().parent();var d=this.$el.find("ul li").index(i);
var h=i.find("textarea").val(),g=this.model.get("commentSet")[d].comment;if(h.length<1){$(f.target).parent().parent().find(".editError").html("メモ・コメントが入力されていません").fadeIn();b.vg.vgrefresh();return;}if(h.length>b.define.MAX_COMMENT_LENGTH){$(f.target).parent().parent().find(".editError").html("1000文字を超えています").fadeIn();
b.vg.vgrefresh();return;}h=_.escape(h);$(f.target).removeClass("btn09").removeClass("modPost").addClass("loading").html("　　");$.ajax({type:"PUT",url:this.model.url()+this.model.get("plan_id"),dataType:"json",data:JSON.stringify({"target_id":this.model.get("target_id"),"member_id":this.model.get("current_member_id"),"comment":h,"comment_id":this.model.get("commentSet")[d].comment_id})}).done(_.bind(function(j,e){this.closeModUI(h,d);
this.model.modComment(h,d);},this)).fail(_.bind(function(e,k,j){this.closeModUI(g,d);$(f.target).parent().parent().find(".editError").html("メモ・コメントの修正に失敗しました").fadeIn();},this));},delComment:function(i){var h="seq"+(new Date()).getTime();
var f=$("#confirmModal").clone().attr("id",h).appendTo($("body"));var g=YAHOO.JP.travel.Mordal({target:f,fselector:".batsu",is_remove:true});var d="";f.find(".comment_modal_delete").show();f.find(".cancel").click(function(){f.find(".batsu").click();
});f.find(".delete").click(_.bind(function(){d=YAHOO.JP.travel.CoverLayer({target:"#"+h,color:"#fff",cback:function(){return false;},loadingImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif",loadingCss:{width:"20px",height:"20px"},addCss:{padding:"20px"},exclusive:false,is_abs:true});
var j=$(i.target).parent().parent();var e=this.$el.find("ul li").index(j);$.ajax({type:"DELETE",url:this.model.url()+this.model.get("plan_id")+"?comment_id="+this.model.get("commentSet")[e].comment_id+"&crumb="+b.data.crumb,dataType:"json"}).done(_.bind(function(l,k){this.model.delComment(e);
if(this.isMoreShowShow()){this.render();}else{this.removeCommentAt(e);}f.find(".batsu").click();},this)).fail(_.bind(function(k,m,l){d.removeCover();f.find(".delError").show();b.vg.vgrefresh();},this));
},this));this.logCountUp();},delComment2:function(f){this.logCountUp();$(f.target).removeClass("btn09").removeClass("del").addClass("loading").html("　　");$(f.target).parent().parent().find(".editError").html("").fadeOut();
var g=$(f.target).parent().parent();var d=this.$el.find("ul li").index(g);$.ajax({type:"DELETE",url:this.model.url()+this.model.get("plan_id")+"?comment_id="+this.model.get("commentSet")[d].comment_id+"&crumb="+b.data.crumb,dataType:"json"}).done(_.bind(function(h,e){this.model.delComment(d);
if(this.isMoreShowShow()){this.render();}else{this.removeCommentAt(d);}},this)).fail(_.bind(function(e,i,h){$(f.target).removeClass("loading").addClass("btn09").addClass("del").html("削除");$(f.target).parent().parent().find(".editError").html("メモ・コメントの削除に失敗しました").fadeIn();
b.vg.vgrefresh();},this));},isMoreShowShow:function(){if(this.$el.find(".sarani").is(":visible")){return true;}else{return false;}},isCommentOwner:function(e){var d=b.viewCollection.viewBaseModel.get("member_id");
return d==e.member_id;},getPosterInfo:function(f){var e=b.viewCollection.viewBaseModel.get("memberInfo");var d={nickname:"unknown",image:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/img_tabitomonoimage_01.png"};
_.each(e,function(g){if(g.member_id==f.member_id){d.nickname=g.nickname;d.image=g.image;}});return d;},logCountUp:function(){YAHOO.JP.travel.Common.getXhrAd("2080267537");}});}(jQuery));(function(b){var a=YAHOO.JP.girlip;a.editButtonView=Backbone.View.extend({events:{"click":"editPlan"},editPlan:function(d){var c=YAHOO.JP.travel.CoverLayer({color:"#fff",cback:function(){return false;},loadingImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif"});
$(d.target).parent().parent().find(".modPlanError").hide();$.ajax({type:"PUT",url:this.model.url()+this.model.get("plan_id")+"?crumb="+a.data.crumb,dataType:"json",data:JSON.stringify({planStatus:this.model.get("plan_status"),loadTime:a.data.loadTime})}).done(_.bind(function(f,e){location.replace(this.model.get("redirect_url"));
},this)).fail(_.bind(function(f,h,g){var e=JSON.parse(f.responseText);if(e.httpcode=="400"&&e.subcode=="006"){$(d.target).parent().parent().find(".modPlanError").html("他のメンバーが編集中です。時間をお<br>いてからページを再表示してください。").fadeIn();
}else{$(d.target).parent().parent().find(".modPlanError").html("エラーが発生しました。").fadeIn();}c.removeCover();},this));}});}(jQuery));(function(b){var a=YAHOO.JP.girlip;a.nextDayLinkView=Backbone.View.extend({el:".nextDay",events:{"click":"showNextDay"},initialize:function(){if(this.model.get("dayLength")>1){this.$el.show();}this.listenTo(a.viewCollection.viewBaseModel,"change:currentScheduleDay",this.render);
},render:function(){if(a.viewCollection.viewBaseModel.get("currentScheduleDay")<this.model.get("dayLength")){this.$el.show();}else{this.$el.hide();}},showNextDay:function(d){var c=a.viewCollection.viewBaseModel;
var f=c.get("currentScheduleDay");YAHOO.JP.travel.Common.getXhrAd(a.data.ad.space_id);c.setCurrentScheduleDay(f+1);if(a.viewCollection.nextDayLinkModel.get("dayLength")==f+1){$("h3.oys span").html("おかえり");
}else{$("h3.oys span").html("おやすみ");}$("html, body").scrollTop(0);}});}(jQuery));$(function(){var h=YAHOO.JP.girlip;h.LIB_COMMON=YAHOO.JP.travel;var f=h.data;h.dateTabClicked=false;var k=window.navigator.userAgent.toLowerCase();var b=window.navigator.appVersion.toLowerCase();if(k.indexOf("msie")!=-1&&b.indexOf("msie 7.")!=-1){h.isIe7=true;
}else{h.isIe7=false;}function j(){h.planFullData={};h.planFullData.planData=h.data.planData;h.planFullData.planComment=h.data.planComment;h.planFullData.crumb=h.data.crumb;h.planFullData.memberList=h.data.memberInfo;
(new YAHOO.JP.travel.girlip.tabitomoModal()).init({target:".tabiTomo > .btnTsuiSak",planId:h.data.planData.planId,userId:h.data.member_id,yappId:h.define.request.appid,deleteCallback:function(i){},addCallback:function(i){}});
$("#tabiTomoMenu #chudanMenu ul li:eq(1) a").attr("href",f.spotmapUrl).attr("target","blank");var o={getPlanId:function(){return YAHOO.JP.girlip.data.planData&&YAHOO.JP.girlip.data.planData.planId;},getMemberData:function(){return YAHOO.JP.girlip.data.memberInfo;
},getCrumb:function(){return YAHOO.JP.girlip.data.crumb;}};YAHOO.JP.girlip.data.userId=YAHOO.JP.girlip.data.member_id;h.siory_memo=YAHOO.JP.travel.girlip.siory_memo({data:YAHOO.JP.girlip.data,schedule:o,trgt:"#else_menu a:eq(0)"});
$.support.noCloneEvent=false;var r=new h.viewCollection;h.viewCollection=r;h.vg=$(".vgridWrapper").vgrid({easing:"easeOutExpo",useLoadImageEvent:false,time:400,delay:20,wait:500,fadeIn:{time:500,delay:50},onStart:function(){},onFinish:function(){r.viewBaseModel.setMasonryLayoutDone();
var v=0,w=0,u=20,t=0,l=false;$(".appo").each(function(x,y){w=$(y).css("top").split("px")[0]-0;if(x==0){return true;}if(x==1){v=w;return true;}if((w-v)<20){t+=u;l=true;}if(t!=0){$(y).css("margin-top",t+"px");
}v=w;});if(l){var i=$(".vgridWrapper").css("height").split("px")[0];$(".vgridWrapper").css("height",(i-0+t)+"px");}}});for(var q=0,n=f.planData.planDays;q<n;q++){new h.dateTabView({collection:r,attributes:{tabIndex:q}});
}var p=_.filter(r.scheduleItemModels,function(i){return i.get("spot_day")==1||i.get("transfer_day")==1;});var s;if(p.length!=0){_.each(p,function(l,i){s=new h.scheduleItemView({model:l,attributes:{itemIndex:i}});
});}else{$(".noPlan").fadeIn();}h.vg.vgrefresh();new h.editButtonView({el:".buttons .btn03 span",model:r.editButtonModel});if(h.isIe7==false){new h.nextDayLinkView({model:r.nextDayLinkModel});}if(p.length==1){s.setAlign();
}}var e=0;if(f.spotImgList.length==0){$("#init_cover").delay(500).fadeOut("fast");$("#disableCover").css("height","100%");j();}for(var g=0,c=f.spotImgList.length;g<c;g++){var a=f.spotImgList[g].split("http://");
var m="";if(a[1]){m=h.data.httpProxy+a[1];}else{m=f.spotImgList[g];}$("<img />").one("load",function(){e++;if(e==f.spotImgList.length){$("#init_cover").delay(500).fadeOut("fast");$("#disableCover").css("height","100%");
j();}}(this)).attr("src",m);}var d=$("#else_menu");$("#chudanMenu .chuHoka").unbind().click(function(){d.toggle();});d.find("a").eq(1).click(function(){YAHOO.JP.travel.girlip.view_print();});});"use strict";YAHOO=YAHOO||{};YAHOO.JP=YAHOO.JP||{};YAHOO.JP.travel=YAHOO.JP.travel||{};YAHOO.JP.travel.girlip=YAHOO.JP.travel.girlip||{};YAHOO.JP.travel.girlip.tabitomoModal=function(){};YAHOO.JP.travel.girlip.tabitomoModal.prototype={init:function(a){this.browser=function(){var h=window.navigator.userAgent.toLowerCase();
var f=window.navigator.appVersion.toLowerCase();var g="unknown";if(h.indexOf("msie")!=-1){if(f.indexOf("msie 6.")!=-1){g="ie6";}else{if(f.indexOf("msie 7.")!=-1){g="ie7";}else{if(f.indexOf("msie 8.")!=-1){g="ie8";
}else{if(f.indexOf("msie 9.")!=-1){g="ie9";}else{if(f.indexOf("msie 10.")!=-1){g="ie10";}else{g="ie";}}}}}}else{if(h.indexOf("trident/7")!=-1){g="ie11";}else{if(h.indexOf("chrome")!=-1){g="chrome";}else{if(h.indexOf("safari")!=-1){g="safari";
}else{if(h.indexOf("opera")!=-1){g="opera";}else{if(h.indexOf("firefox")!=-1){g="firefox";}}}}}}return g;}();this.message={};this.message.mailbody="Girlipで旅行情報を作りましょう。";this.message.no_user="登録されている旅ともは0人です。";
this.message.system_err="システムエラーが発生しました。";this.LIB_COMMON=YAHOO.JP.travel;this.PLAN_ID=a.planId;this.USER_ID=a.userId;this.OWNER_ID=YAHOO.JP.girlip.planFullData.memberList?YAHOO.JP.girlip.planFullData.memberList[0].member_id:YAHOO.JP.girlip.data.memberInfo[0].member_id;
this.MEMBER_API="/api/member/"+this.PLAN_ID;this.MEMBER_SAPI="/sApi/member/"+this.PLAN_ID;this.addCallback=a.addCallback;this.deleteCallback=a.deleteCallback;function d(){}this.changeNicknameCallback=a.changeNicknameCallback||d;
this.girlip=YAHOO.JP.travel.girlip;this.shareMailBtn=$("#tabiTomoMenu .chuEmail");this.modal_id="#tabitomo_modal";this.chgNameModal_id="#change_profile_modal";this.modal=$(this.modal_id);this.chgNameModal=$(this.chgNameModal_id);
this.menu=$("#tabitomo_modal .frndMenu");this.menuAdd=$("#tabitomo_modal .frndMenu .add");this.menuDel=$("#tabitomo_modal .frndMenu .del");this.tabAll=$("#tabitomo_modal .frndBody");this.tabAdd=$("#tabitomo_modal .tabAdd");
this.tabDel=$("#tabitomo_modal .tabDel");this.wrapper=$("#tabitomo_modal .frndSlideWrapper");this.tabAddWrapper=$("#tabitomo_modal .tabAdd  .frndSlideWrapper");this.tabDelWrapper=$("#tabitomo_modal .tabDel  .frndSlideWrapper");
this.prevBtn=$("#tabitomo_modal .btnPrev01");this.nextBtn=$("#tabitomo_modal .btnNext01");this.addBtn=$("#tabitomo_modal .tabAdd  .frndMail a");this.delBtn=$("#tabitomo_modal .tabDel  .frndSbmtBtn a");
this.chgNameBtn=this.chgNameModal.find(".nicknameEditBtn");this.carousel=$("#tabiTomoMenu ul.tabiTomoMemberList");this.carouselPrevBtn=$("#tabiTomoMenu .btnPrev03");this.carouselNextBtn=$("#tabiTomoMenu .btnNext03");
this.spaceId={add:"2080267525",del:"2080267526",edit:"2080277919"};this.upload_file=null;this.original_file_name=null;this.$iconUploadInput=$("input#iconUploadFile");this.$iconUploadForm=$("form#iconUploadForm");
this.$iconUploadFrame=$("iframe#iconUploadFrame");this.$iconChangeError=$(".iconChangeError");this.$profileModalBody=$("#change_profile_modal .modalBody");this.$modalIconChangeBody=$(".modalIconChangeBody");
this.$iconChangeImg=$("img#iconChangeImage");this.$iconChangeFrame=$(".iconChangeFrame");this.$iconChangeDragWrapper=$(".iconChangeDragWrapper");this.$iconResizeNavi=$("#iconResizeNavi");this.$iconResizeOkButton=$("#iconResizeOkButton");
this.$iconResizeNgButton=$("#iconResizeNgButton");this.$modalIcon=$(".credentialLine img");this.$carouselOwnIconIndex=null;this.$modalCloseButton=$("#change_profile_modal .modal_batsu_a");this.old_slider_value=0;
this.$iconUploadInput.removeAttr("disabled");this.modal.find("input").placeholder();$("#change_profile_modal").find("input").placeholder({ncolor:"#000"});this.activeTab="add";this.wrapper={"add":{"offset":0,"length":0,"$el":this.tabAddWrapper},"del":{"offset":0,"length":0,"$el":this.tabDelWrapper},"carousel":{"offset":0,"length":0,"$el":this.carousel}};
$(a.target).click($.proxy(function(f){f.preventDefault();if(YAHOO.JP.girlip.planFullData.planData.planStatus=="0"){this.nosaveModal();return;}if(this.USER_ID!=this.OWNER_ID){this.noownerModal();return;
}YAHOO.JP.travel.Mordal({target:this.modal_id,fselector:".batsu"});$(this.modal_id).find(".batsu").click($.proxy(function(){this.menu.find(".menuDisabled").removeClass("menuDisabled");$(this.modal_id).find(".batsu").off("click");
},this));this.modal.find(".batsu").click($.proxy(function(){this.modal.find(".error").text("");},this));this.mailBodyFix();this.menuAdd.trigger("click");},this));this.tabAdd.find("input.nickname").on("change keyup",function(){e($(this),18);
});this.chgNameModal.find("input.nickname").on("change keyup",function(){e($(this),18);});function e(g,i){var f=g.val();var h=YAHOO.JP.travel.Common.setStringFormat({text:f,num:i,isMulti:true,doted:""});
if(!h.result){g.val(h.text);}}this.shareMailBtn.click($.proxy(function(f){f.preventDefault();if(YAHOO.JP.girlip.planFullData.planData.planStatus=="0"){this.nosaveModal();return;}if(this.USER_ID!=this.OWNER_ID){this.noownerModal();
return;}YAHOO.JP.travel.Mordal({target:this.modal_id,fselector:".batsu"});this.mailBodyFix();this.menuAdd.trigger("click");},this));this.menuAdd.click($.proxy(function(f){f.preventDefault();if(c(this.menuAdd)){return;
}this.mailBodyFix();$("#addTabitomoMailBodyNickname").text(this.carousel.find(".crown").eq(0).parents("li").attr("data-member_nickname"));this.wrapper.add.length=5;b("add",this.menuAdd,this.tabAdd,this.tabAddWrapper);
YAHOO.JP.travel.Common.getXhrAd(this.spaceId.add);},this));this.menuDel.click($.proxy(function(f){f.preventDefault();if(c(this.menuDel)){return;}b("del",this.menuDel,this.tabDel,this.tabDelWrapper);this.delView();
YAHOO.JP.travel.Common.getXhrAd(this.spaceId.del);},this));function c(f){var g="menuDisabled";return f.hasClass(g);}var b=$.proxy(function(f,l,i,g){this.activeTab=f;this.wrapper[this.activeTab].offset=0;
this.prevnextCheck();j(g);h(this.tabAll,i);k(this.menu,l);function h(m,n){m.hide();n.show();}function j(m){m.css("left","0");}function k(m,n){var o="menuDisabled";m.find("."+o).removeClass(o);n.addClass(o);
}},this);$("#changeNickname").click($.proxy(function(){this.modal.find(".batsu").trigger("click");this.carousel.find("li.owner").eq(0).trigger("click");},this));this.nextBtn.click($.proxy(function(f){f.preventDefault();
if(this.nextBtn.hasClass("menuDisabled")){return;}this._movePaging(+1);this.prevnextCheck();},this));this.prevBtn.click($.proxy(function(f){f.preventDefault();if(this.prevBtn.hasClass("menuDisabled")){return;
}this._movePaging(-1);this.prevnextCheck();},this));this.addBtn.click($.proxy(function(l){l.preventDefault();this.tabAdd.find(".success, .error").text("");var m={};var o={"memberList":[]};o.messageTitle=this.tabAdd.find(".mailTitle").val();
o.messageBody=this.tabAdd.find(".mailBody").val();o.planTitle=YAHOO.JP.girlip.planFullData.planData.planTitle||"";if(YAHOO.JP.girlip.planFullData.planData.planTitle==""){var n=YAHOO.JP.girlip.planFullData.planData.planTitle;
}var h=this.tabAdd.find("li").eq(0).find(".nickname").attr("placeholder");var k=this.tabAdd.find("li").eq(0).find(".mailaddress").attr("placeholder");this.tabAdd.find("li").each($.proxy(function(r,s){var p=$(s).find(".nickname").val()||false;
var q=$(s).find(".mailaddress").val()||false;if(p==h){p=false;}if(q==k){q=false;}if(p&&q){o.memberList.push({"nickname":p,"email":q});if(!this._isMailAddress(q)){m.invalid_mail="メールアドレスが正しくありません。";}}else{if((!p&&q)||(p&&!q)){m.no_set="ニックネームとメールアドレスの両方を入力してください。";
if(!this._isMailAddress(q)){m.invalid_mail="メールアドレスが正しくありません。";}}else{}}if(this._isNgMTFFormat(p)){m.ng_nickname_body="ニックネーム・メッセージに使用できない文字が含まれています。（@ < > など）";}},this));if(this._isNgMTFFormat(o.messageBody)){m.ng_nickname_body="ニックネーム・メッセージに使用できない文字が含まれています。（@ < > など）";
}if(o.memberList.length==0&&this.getObjectLength(m)==0){m.nothig="ニックネーム・メールアドレスを入力してください。";}if(this.getObjectLength(m)!=0){var g="";var j=0;for(var f in m){if(j==2){g+="<br>";}g+=" "+m[f];j++;}this.tabAdd.find(".error").html(g);
return;}this.tabAdd.find(".tabitomoListWaiting").css("display","block");this.addTabitomo(o).fail($.proxy(function(p){var q="";if(p.responseText){var i=JSON.parse(p.responseText);switch(i.subcode){case"003":case"006":q="既に招待済みのメールアドレスが含まれています。";
break;default:q="旅ともの追加に失敗しました。";break;}}else{q="旅ともの追加に失敗しました。";}this.tabAdd.find(".tabitomoListWaiting").css("display","none");this.tabAdd.find(".error").text(q);return;},this)).done($.proxy(function(i){this.tabAdd.find(".tabitomoListWaiting").css("display","none");
this.tabAdd.find(".error").text("");this.tabAdd.find("li").each(function(p,q){$(this).find(".nickname").val("");$(this).find(".mailaddress").val("");});this.tabAdd.find(".mailTitle").val(this.tabAdd.find(".mailTitle").attr("data-defvalue"));
this.tabAdd.find(".mailBody").val(this.tabAdd.find(".mailBody").attr("data-defvalue"));this.getTabitomo().done($.proxy(function(p){this.addCallback(p);this.showTabitomoCarousel(this.carousel,p);this.modal.find(".batsu").trigger("click");
this.showSimpleModal("招待メールを送信しました。");},this));},this));},this));this.delBtn.click($.proxy(function(j){j.preventDefault();if(this.tabDelWrapper.find("li").length==0){return;}var i={};var f={"memberIdList":[]};
this.tabDelWrapper.find(".check.on").parents("li").each(function(){f.memberIdList.push({"member_id":$(this).attr("data-member_id"),"delete":1});});if(f.memberIdList.length==0){i.nothig="旅ともを選択してください。";
}if(this.getObjectLength(i)!=0){var h="";for(var g in i){h+=" "+i[g];}this.tabDel.find(".error.sendError").text(h);return;}this.delTabitomo(f).fail($.proxy(function(k){this.tabDel.find(".error.sendError").text("削除に失敗しました。");
},this)).done($.proxy(function(k){this.delView(this.addCallback);},this));},this));this.modal.find(".mailBody").on("keydown",($.proxy(function(j){var m=$(j.target);var k=m.val();var g=1;for(var h=0,f=k.length;
h<f;h++){if(k.charAt(h)=="\n"){g++;}}m.attr("rows",g+1);},this)));this.chgNameBtn.click($.proxy(function(i){i.preventDefault();var h=this.chgNameModal;if(h.find(".nicknameEditBtn").hasClass("editDisabled")){return;
}var g=h.find("input.nickname").val();if(g==""||!g){$(".chngProfModal .nickname_msg.error").text("ニックネームを入力してください。").css("display","inline-block");return;}if(this._isNgMTFFormat(g)){$(".chngProfModal .nickname_msg.error").html("ニックネームに使用できない文字が含まれています。<br>（@ < > など）").css("display","inline-block");
return;}h.find(".waiting").css("display","block");var f={};f.memberIdList=[];f.memberIdList.push({"member_id":h.attr("data-member_id"),"nickname":g});this.changeNickname(f).fail($.proxy(function(j){$(".chngProfModal .nickname_msg.error").text("変更に失敗しました。").css("display","inline-block");
h.find(".waiting").css("display","none");},this)).done($.proxy(function(j){this.getTabitomo().done($.proxy(function(k){h.find(".waiting").css("display","none");this.showTabitomoCarousel(this.carousel,k);
this.carousel.css("transition","all 0.2s");this.carouselNextPrevCheck();h.find(".batsu").trigger("click");this.changeNicknameCallback(k);},this));},this));},this));$("#changeProfileModalDeleteBtn").click($.proxy(function(){$(".chngProfModal .batsu").trigger("click");
this.shareMailBtn.trigger("click");this.menuDel.trigger("click");},this));this.$iconUploadInput.on({change:$.proxy(function(f){if(this.browser==="ie8"||this.browser==="ie9"||this.browser==="ie7"||this.browser==="ie6"){this.changeUploadForm(f);
}else{this.fileSelect(f);}},this)});this.$iconUploadFrame.load($.proxy(function(f){this.loadComplete(f);},this));this.$iconResizeNgButton.on({click:$.proxy(function(f){this.resizeCancelProcess(f);},this)});
this.$iconResizeOkButton.on({click:$.proxy(function(f){this.resizeSubmitProcess(f);},this)});this.getTabitomo().done($.proxy(function(f){this.showTabitomoCarousel(this.carousel,f);this.carousel.css("transition","all 0.2s");
this.carouselNextPrevCheck();},this));this.carouselNextBtn.click($.proxy(function(g){g.preventDefault();if(this.carouselNextBtn.attr("data-active")=="disabled"){return;}this.wrapper.carousel.offset++;var f="390";
this.carousel.css("left",f*this.wrapper.carousel.offset*-1+"px");this.carouselNextPrevCheck();},this));this.carouselPrevBtn.click($.proxy(function(g){g.preventDefault();if(this.carouselPrevBtn.attr("data-active")=="disabled"){return false;
}this.wrapper.carousel.offset--;var f="390";this.carousel.css("left",f*this.wrapper.carousel.offset*-1+"px");this.carouselNextPrevCheck();},this));},delView:function(a){if(!a){a=function(){};}this.showWaiting(this.tabDelWrapper);
this.getTabitomo().fail($.proxy(function(){this.tabDelWrapper.html('<p class="error">旅とも情報を取得できませんでした。</p>');},this)).done($.proxy(function(b){if(b.length==1){this.tabDel.find(".frndSbmtBtn > .btn03 > span").addClass("tabitomoBtnDisabled");
}else{this.tabDel.find(".frndSbmtBtn > .btn03 > span").removeClass("tabitomoBtnDisabled");}this.showTabitomoList(this.tabDelWrapper,b);this.showTabitomoCarousel(this.carousel,b);a(b);},this));},mailBodyFix:function(){var b="";
if(YAHOO.JP.girlip.planFullData.planData.planTitle){b=YAHOO.JP.girlip.planFullData.planData.planTitle;}if($("#title_view").text()!=""){b=$("#title_view").text();}var a=YAHOO.JP.girlip.planFullData.currentUrl||"";
if(a==""){a=location.href;}this.modal.find(".mailBody_title").text(b);this.modal.find(".mailBody_url").text(a);},showTabitomoCarousel:function(j,f){this.wrapper.carousel.length=this._array_chunk(f,5).length;
var b="<div>";for(var c=0,e=f.length;c<e;c++){var h=YAHOO.JP.travel.Common.setStringFormat({text:f[c].nickname,num:10,isMulti:true,isDot:".."});var d=h.result?f[c].nickname:h.text;var a=(f[c].type=="owner")?'<span class="crown">オーナー</span>':"";
b+='<li class="'+f[c].type+'" data-member_id="'+f[c].member_id+'" data-type="'+f[c].type+'" data-member_nickname="'+f[c].nickname+'">'+'<div><img width="100" height="100" alt="'+f[c].nickname+'" src="'+f[c].image+'"></div>'+"<p>"+d+"</p>"+a+'<a href="javascript:void(0);">選択</a></li>'+"</li>";
if(f[c].member_id==this.USER_ID){this.$carouselOwnIconIndex=c;}}b+="</div>";if(f.length==1){b+='<p class="tabitomoCarouselMessage"><span>一緒にしおりを作る<br>旅ともを招待しましょう</span></p>';}var g=$(b);g.find("li").each($.proxy(function(k,l){$(l).click($.proxy(function(){YAHOO.JP.travel.Common.getXhrAd(this.spaceId.edit);
var i=false;var n=this.USER_ID;var m=this.OWNER_ID;if(n==$(l).attr("data-member_id")){i=true;}var o=false;if(n==m){o=true;}this.changeProfileModal({"member_id":$(l).attr("data-member_id"),"image_url":$(l).find("img").attr("src"),"nickname":$(l).find("img").attr("alt"),"type":$(l).attr("data-type"),"own_flg":i,"owner_flg":o});
},this));},this));j.html(g);this.carouselNextPrevCheck();},showTabitomoList:function(n,c,e){var g=e?true:false;var k=c.concat();for(var f=0,h=k.length;f<h;f++){if(k[f].member_id==this.USER_ID){k.splice(f,1);
h--;}}var k=this._array_chunk(k,6);if(k.length==0){n.css("width",k.length*100+"%").html('<p class="error">登録された旅ともはいません。</p>');this.wrapper[this.activeTab].length=0;this.prevnextCheck();return;}var a="";
for(var f=0,h=k.length;f<h;f++){a+='<ul class="frndList">';for(var d=0,m=k[f].length;d<m;d++){var l=k[f][d].member_id?'data-member_type="'+k[f][d].type+'" data-member_id="'+k[f][d].member_id+'"':'data-facebook_id="'+k[f][d].facebook_id+'"';
var b=g?'<span class="check on"></span>':'<span class="check off"></span>';a+="<li "+l+'><img width="60" height="60" src="'+k[f][d].image+'" alt="person">'+'<span class="name">'+k[f][d].nickname+"</span> "+b+"</li>";
}a+="</ul>";}this.wrapper[this.activeTab].length=k.length;n.css("width",k.length*100+"%").html(a);n.find(".check.off").css("opacity",".2");n.find("li").click(function(){var i=$(this).find(".check");if(i.hasClass("on")){i.addClass("off").removeClass("on").css("opacity",".2");
}else{i.addClass("on").removeClass("off").css("opacity","1");}});this.prevnextCheck();},getTabitomo:function(){var a=$.Deferred();this._send(this.MEMBER_API).fail(function(b){a.reject(b);}).done(function(d){if(d.member_list.length==undefined){var f=d.member_list;
d.member_list=[];d.member_list.push(f);}for(var e=0,b=d.member_list.length;e<b;e++){if(d.member_list[e].type=="facebook"){var c=d.member_list[e].image.match(/\/([0-9]+)\/picture$/);d.member_list[e].facebook_id=c[1]||false;
}d.member_list[e].nickname=decodeURI(d.member_list[e].nickname);}a.resolve(d.member_list);});return a.promise();},addTabitomo:function(a){return this._send(this.MEMBER_API,"POST",a);},delTabitomo:function(a){return this._send(this.MEMBER_SAPI,"PUT",a);
},changeNickname:function(a){return this._send(this.MEMBER_SAPI,"PUT",a);},_send:function(b,d,a){if(!d){d="GET";}if(!a){a={};}if(!a){return false;}var c=$.Deferred();$.ajax({url:b,data:JSON.stringify(a),type:d,contentType:"application/json",dataType:"json",cache:false}).fail(function(e){c.reject(e);
}).done(function(e){c.resolve(e);});return c.promise();},_isNgMTFFormat:function(a){var b=/http|@|<|>|%|&|\|/;return b.test(a);},_isMailAddress:function(a){var b=/.+@.+\..+/;return b.test(a);},_array_chunk:function(d,f){for(var a,e=0,h=-1,b=d.length,g=[];
e<b;e++){(a=e%f)?g[h][a]=d[e]:g[++h]=[d[e]];}return g;},_movePaging:function(a){this.wrapper[this.activeTab].offset+=a;this.wrapper[this.activeTab].$el.css("left",this.wrapper[this.activeTab].offset*100*-1+"%");
},prevnextCheck:function(a){var b="menuDisabled";if(this.wrapper[this.activeTab].offset<=0){this.prevBtn.addClass(b);}else{this.prevBtn.removeClass(b);}if(this.wrapper[this.activeTab].offset>=this.wrapper[this.activeTab].length-1){this.nextBtn.addClass(b);
}else{this.nextBtn.removeClass(b);}},carouselNextPrevCheck:function(){if(this.wrapper.carousel.offset<=0){this.carouselPrevBtn.addClass("opq").attr("data-active","disabled");}else{this.carouselPrevBtn.removeClass("opq").removeAttr("data-active");
}if(this.wrapper.carousel.offset>=this.wrapper.carousel.length-1){this.carouselNextBtn.addClass("opq").attr("data-active","disabled");}else{this.carouselNextBtn.removeClass("opq").removeAttr("data-active");
}},showWaiting:function(b){var a='<div class="tabitomoListWaiting" style="opacity:0;">'+'<img src="//s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif"></div>';b.html(a);setTimeout(function(){b.find(".tabitomoListWaiting").css("opacity","1");
},300);},nosaveModal:function(){this.showSimpleModal("旅ともの招待は、しおりを一時保存または決定後に利用する事が出来ます。");},noownerModal:function(){this.showSimpleModal("旅ともを追加削除できるのは、しおり作成者のみです。");},showSimpleModal:function(a){YAHOO.JP.travel.Common.makeModal({target:"#tabitomo_modal_message_1",text:a,cancel_text:"<span>とじる</span>",text_sel:"#normal_modal_text",cancel_sel:"#normal_modal_cancel",close_sel:".mdl_cancel",cancel:function(){YAHOO.JP.girlip.stopUnload=true;
},close:function(){}});},changeProfileModal:function(b){var a=this.chgNameModal;$(".chngProfModal .nickname_msg.error").text("").css("display","none");a.attr("data-member_id",b.member_id);a.find(".person img").attr({"src":b.image_url,"alt":b.nickname});
a.find("input.nickname").val(b.nickname);if(b.owner_flg&&b.own_flg||!b.owner_flg){a.find(".delete").css("display","none");}else{a.find(".delete").css("display","block");}if(b.own_flg){a.find("h5.nickname > span").text("（18文字まで）");
a.find("h5.credential > span").text("（画像をアップロードしてアイコン画像を変更出来ます）");a.find("input.nickname").removeAttr("readonly").removeClass("editDisabled");a.find(".nicknameEditBtn").removeClass("editDisabled");a.find("#iconUploadFile").removeAttr("disabled");
}else{a.find("h5.nickname > span").text("（ご自身のみニックネームの変更が可能です）");a.find("h5.credential > span").text("（ご自身のみアイコン画像の変更が可能です）");a.find("input.nickname").attr("readonly","readonly").addClass("editDisabled");
a.find(".nicknameEditBtn").addClass("editDisabled");a.find("#iconUploadFile").attr("disabled","disabled");}YAHOO.JP.travel.Mordal({target:this.chgNameModal_id,fselector:".batsu"});},getObjectLength:function(c){var b=0;
for(var a in c){b++;}return b;},changeUploadForm:function(c){if(this.processLock){return;}var d=this.$iconUploadInput.val();if(!d){return;}this.$iconChangeError.text("");d=encodeURIComponent(d).replace(/^.*\%5C/,"");
d=decodeURIComponent(d).replace(/\/$/,"").replace(/^.*\//,"");if(!d){return;}this.processLock=true;var a=['<input class="tmp_input" type="hidden" name="output" value="json">','<input class="tmp_input" type="hidden" name="loadTime" value="'+YAHOO.JP.girlip.planFullData.loadTime+'">','<input class="tmp_input" type="hidden" name="file_name" value="'+d+'">','<input class="tmp_input" type="hidden" name="planId" value="'+YAHOO.JP.girlip.planFullData.planData.planId+'">','<input class="tmp_input" type="hidden" name="target_type" value="1">','<input class="tmp_input" type="hidden" name="o_width" value="200">','<input class="tmp_input" type="hidden" name="o_height" value="200">'];
for(var b=0;b<a.length;b++){this.$iconUploadInput.after(a[b]);}this.$iconUploadForm.submit();},fileSelect:function(d){this.old_slider_value=0;var b=this.upload_file=this.$iconUploadInput.prop("files")[0];
this.original_file_name=b.name;this.$iconChangeError.text("").show();if(!b.type.match("image.*")){this.$iconChangeError.text("画像ファイルを選択してください："+b.type);return;}if(b.size>10000000){this.$iconChangeError.text("画像のファイルサイズが大きすぎます : "+b.size+"bytes");
return;}var a=new FileReader();var c=new Image();a.onload=$.proxy(function(f){c.onload=$.proxy(function(k){this.$profileModalBody.hide();this.$modalIconChangeBody.show();this.$iconResizeNavi.fadeIn();this.$modalCloseButton.hide();
this.original_image_width=c.width;this.original_image_height=c.height;this.iconChangeFrameWidth=this.$iconChangeFrame.width();this.iconChangeFrameHeight=this.$iconChangeFrame.height();if(c.width<c.height){this.fit_by_height_flg=false;
this.$iconChangeImg.attr("width",this.iconChangeFrameWidth);}else{this.fit_by_height_flg=true;this.$iconChangeImg.attr("height",this.iconChangeFrameHeight);}$("#iconResizeSlider").slider({slide:$.proxy(this.slideChange,this),"value":0});
this.$iconChangeImg.draggable({enable:true});this.$iconChangeImg.draggable({containment:".iconChangeDragWrapper"});var i=-(this.$iconChangeImg.height()-this.iconChangeFrameHeight),g=-(this.$iconChangeImg.width()-this.iconChangeFrameWidth),h=this.$iconChangeImg.width()*2-this.iconChangeFrameWidth,j=this.$iconChangeImg.height()*2-this.iconChangeFrameHeight;
this.iconChangeImageHeight=this.$iconChangeImg.height();this.iconChangeImageWidth=this.$iconChangeImg.width();this.iconChangeImageTop=Math.round((j-this.iconChangeImageHeight)/2);this.iconChangeImageLeft=Math.round((h-this.iconChangeImageWidth)/2);
if(this.fit_by_height_flg===false){this.$iconChangeImg.css("top",this.iconChangeImageTop+"px");this.$iconChangeDragWrapper.css("width",this.iconChangeFrameWidth).css("height",j).css("top",i);}else{this.$iconChangeImg.css("left",this.iconChangeImageLeft+"px");
this.$iconChangeDragWrapper.css("width",h).css("height",j).css("left",g);}},this);c.src=a.result;this.$iconChangeImg.attr("src",a.result);},this);a.readAsDataURL(b);},slideChange:function(i,j){if(j.value>this.old_slider_value){this.slider_up=true;
}else{this.slider_up=false;}this.old_slider_value=j.value;var a=this.$iconChangeDragWrapper.width();var k=this.$iconChangeDragWrapper.height();var g=this.iconChangeImageWidth+Math.round(j.value/100*this.iconChangeImageWidth);
var c=this.iconChangeImageHeight+j.value/100*this.iconChangeImageHeight;this.$iconChangeDragWrapper.css("width",g*2-this.iconChangeFrameWidth);this.$iconChangeDragWrapper.css("height",c*2-this.iconChangeFrameHeight);
this.$iconChangeDragWrapper.css("left",(g-this.iconChangeFrameWidth)*-1);this.$iconChangeDragWrapper.css("top",(c-this.iconChangeFrameHeight)*-1);if(this.fit_by_height_flg===false){this.$iconChangeImg.attr("width",g);
}else{this.$iconChangeImg.attr("height",c);}if(!this.slider_up){var f=parseInt(this.$iconChangeImg.css("top"));var d=parseInt(this.$iconChangeImg.css("left"));var b=(this.$iconChangeDragWrapper.width()-this.iconChangeFrameWidth)/2;
var h=(this.$iconChangeDragWrapper.height()-this.iconChangeFrameHeight)/2;if((b/2)<d){this.$iconChangeImg.css("left",d-(a-this.$iconChangeDragWrapper.width())/2);}else{this.$iconChangeImg.css("left",d-Math.floor(d/j.value));
}if((h/2)<f){this.$iconChangeImg.css("top",f-(k-this.$iconChangeDragWrapper.height())/2);}else{this.$iconChangeImg.css("top",f-Math.round(f-this.gaiyo_top)/j.value);}}},resizeCancelProcess:function(a){this.$modalIconChangeBody.hide();
this.$iconResizeNavi.hide();this.$profileModalBody.fadeIn();this.$modalCloseButton.show();this.$iconChangeImg.attr("src",this.old_haikei);this.$iconChangeImg.draggable("destroy").css("opacity",1);this.$iconChangeDragWrapper.css("top",0).css("left",0);
this.$iconChangeImg.css("top",0).css("left",0).removeAttr("width").removeAttr("height");},resizeSubmitProcess:function(f){if(!this.iconUploadCover){this.iconUploadCover=this.LIB_COMMON.CoverLayer({target:".iconChangeFrame",cback:function(){return false;
},color:"#fff",loadingImage:"https://s.yimg.jp/images/travel/dev/girlip/v2/images/loading.gif",loadingCss:{width:"40px",height:"40px"},exclusive:false,is_abs:false});}else{this.iconUploadCover.showCover(true,function(){});
}var c=this.$iconChangeImg.width()/this.original_image_width;var b=Math.round(this.iconChangeFrameWidth/this.$iconChangeImg.width()*this.original_image_width),a=Math.round((-parseInt(this.$iconChangeDragWrapper.css("left"))-parseInt(this.$iconChangeImg.css("left")))/c),g=Math.round((-parseInt(this.$iconChangeDragWrapper.css("top"))-parseInt(this.$iconChangeImg.css("top")))/c);
if(g<0){g=0;}if(a<0){a=0;}var d=new FormData();d.append("target_type",1);d.append("planId",YAHOO.JP.girlip.planFullData.planData.planId);d.append("file_name",this.original_file_name);d.append("loadTime",YAHOO.JP.girlip.planFullData.loadTime);
d.append("output","json");d.append("x",a);d.append("y",g);d.append("width",b);d.append("height",b);d.append("o_width",200);d.append("o_height",200);d.append("blob",this.upload_file);$.ajax({url:"/api/upload",type:"POST",data:d,timeout:300000,processData:false,contentType:false}).done($.proxy(function(e){e=jQuery.parseJSON(e);
this.$iconChangeImg.draggable("destroy").css("opacity",1);this.$iconChangeDragWrapper.css("top",0).css("left",0);this.$iconChangeImg.css("top",0).css("left",0).removeAttr("width").removeAttr("height");
this.$modalIcon.attr("src",e.imageUrl);this.carousel.find("img").eq(this.$carouselOwnIconIndex).attr("src",e.imageUrl);this.iconUploadCover.hideCover(true);this.$modalCloseButton.show();this.$iconResizeNavi.hide();
this.$modalIconChangeBody.hide();this.$profileModalBody.show();},this)).fail($.proxy(function(e,i,h){this.$iconChangeError.text("アップロード時にエラーが発生しました："+e.status+" "+e.statusText);this.$iconChangeImg.draggable("destroy").css("opacity",1);
this.$iconChangeDragWrapper.css("top",0).css("left",0);this.$iconChangeImg.css("top",0).css("left",0).removeAttr("width").removeAttr("height");this.iconUploadCover.hideCover(true);this.$modalCloseButton.show();
this.$iconResizeNavi.hide();this.$modalIconChangeBody.hide();this.$profileModalBody.show();},this));},loadComplete:function(){this.$iconUploadForm.find("input.tmp_input").remove();this.processLock=false;
try{var h=this.upframe.contents(),d=h.find("body").text().replace(/\r?\n/g,""),f,c,b;if(!d){this.uploadError();return;}var a=$.parseJSON(d);f=a.httpcode;c=a.imageId;b=a.imageUrl;}catch(g){this.$iconChangeError.text("アップロード時にエラーが発生しました。");
return;}if(f===""||f==="500"||!c||!b){this.$iconChangeError.text("アップロード時にエラーが発生しました："+status+" "+message);return;}this.$modalIcon.attr("src",b);this.carousel.find("img").eq(this.$carouselOwnIconIndex).attr("src",b);
}};